<html>

<head>

<style>
#control_panel {
border: 1px solid #888;
padding: 4px;
}
</style>

<title>Interactive Saguaro Astronomy Club Database</title>

<script src="../queryable/queryable.js"></script>
<script src="SAC_database.js"></script>
<script src="pager.js"></script>


</head>

<body>

<h2>Saguaro Astronomy Club Interactive database</h2>
<div id="control_panel">
<strong>Set dropdowns to refine query</strong><br>
Minimum Magnitude: 
<select id="min_mag" name="min_mag">
<option value="any"> - </option>
</select><br>
Maximum Magnitude: 
<select id="max_mag" name="max_mag">
<option value="any"> - </option>
</select><br>

Object Type: 
<select id="object_type" name="object_type">
<option value="all"> - </option>
<option value="ASTER">Asterism</option>
<option value="BRTNB">Bright Nebula</option>
<option value="CL+NB">Cluster with Nebulosity</option>
<option value="DRKNB">Dark Nebula</option>
<option value="GALCL">Galaxy Cluster</option>
<option value="GALXY">Galaxy</option>

<option value="GLOCL">Globular Cluster</option>
<option value="OPNCL">Open Cluster</option>
<option value="PLNNB">Planetary Nebula</option>
<option value="SNREM">Supernova Remnant</option>
<option value="QUASR">Quasar</option>

<option value="1STAR">Star</option>
<option value="2STAR">Binary Star</option>
<option value="3STAR">3STAR</option>
<option value="4STAR">4STAR</option>
<option value="8STAR">8STAR</option>

<option value="NONEX">Nonexistant</option>

<option value="G+C+N">Cluster with Nebulosity in a Galaxy</option>
<option value="GX+DN">Diffuse Nebula in a Galaxy</option>
<option value="GX+GC">Globular Cluster in a Galaxy</option>

<option value="LMCCN">Cluster with Nebulosity in the LMC</option>
<option value="LMCOC">Open cluster in the LMC</option>
<option value="LMCGC">Globular Cluster in the LMC</option>
<option value="LMCDN">Diffuse Nebula in the LMC</option>

<option value="SMCCN"> Cluster with Nebulosity in the SMC </option>
<option value="SMCGC"> Globular Cluster in the SMC </option>
<option value="SMCOC"> Open cluster in the SMC </option>
<option value="SMCDN"> Diffuse Nebula in the SMC </option>
</select>
</div>

&nbsp;<br />&nbsp;

<div id="report">&nbsp;</div>
<div id="table_container"></div>

<script>
/*
 * INITS
 */
var db = queryable.open( {data:SAC_db} );

/*
 * FUNCS
 */
function obj_keys( obj ) {
  var a= [];
  for ( var k in obj ) {
    if ( obj.hasOwnProperty(k) ) {
      a.push(k);
    }
  }
  return a;
}
function obj_vals( obj ) {
  var a= [];
  for ( var k in obj ) {
    if ( obj.hasOwnProperty(k) ) {
      a.push(obj[k]);
    }
  }
  return a;
}

document.getElementById('object_type').onchange = function() 
{
  var table_cont = document.getElementById("table_container");
  table_cont.innerHTML = '<div>computing...<br><img height="100px" width="100px" src="ajax_loader_gray_512.gif" alt="" /></div>';

  setTimeout( function() {
    var e = document.getElementById('object_type');
    var val = e.options[e.selectedIndex].value;
    var res = db.find( { type: val} );

    var table = new CTable({'style':{'table':{'border':bord},'td':{'border':ibord}}});
    table.setParent( table_cont );
    table.headers = obj_keys( res.rows[0] );
    table.headers.shift(); // remove '_id' field
    for ( var i = 0; i < res.length; i++ ) 
    {
      var vals = obj_vals( res.rows[i] );
      vals.shift(); // remove '_id' fields
      table.add_row( vals );
    }

    table_cont.innerHTML = table.html();

    document.getElementById("report").innerHTML = 'returned <strong>' + res.length + '</strong> results';
  }, 500 );
};

/*
 * CREATE DROPDOWNS
 */
var min_mag = document.getElementById( 'min_mag' );
var max_mag = document.getElementById( 'max_mag' );
for (var i = 1; i <= 20; i++) {
    var opt = new Option ( (i < 10 ? "0": "") + i, "" + i);
    min_mag.options.add( opt ) ;
    var opt = new Option ( (i < 10 ? "0": "") + i, "" + i);
    max_mag.options.add( opt );
}

/* 
 * DO STUFF
 */
var res = db.find( { type:"GALXY","mag":{$lte:11.5},"dec_deg":{$gt:0} } ).sort( {mag:1} );

var bord = '1px solid #888';
var ibord = '1px solid #CCC';

var table = new CTable({'style':{'table':{'border':bord},'td':{'border':ibord}}});
table.setParent( e );
table.headers = obj_keys( res.rows[0] );
table.headers.shift(); // remove '_id'
for ( var i = 0; i < res.length; i++ ) 
{
  var vals = obj_vals( res.rows[i] );
  vals.shift(); // remove '_id'
  table.add_row( vals );
}

var e = document.getElementById("table_container");
e.innerHTML = table.html();
</script>


</body>
</html>
